<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Meta Tags -->
    <title>BiblioTech Pro | Sistema de Gesti√≥n de Biblioteca Digital</title>
    <meta name="description"
        content="Sistema profesional de gesti√≥n bibliotecaria con inteligencia artificial. Descubre, reserva y gestiona tu colecci√≥n de libros de forma inteligente.">
    <meta name="keywords" content="biblioteca, libros, pr√©stamos, reservas, gesti√≥n bibliotecaria, IA, recomendaciones">
    <meta name="author" content="Xavier Aerox">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="BiblioTech Pro - Biblioteca Digital Inteligente">
    <meta property="og:description"
        content="Sistema de gesti√≥n bibliotecaria con IA integrada para recomendaciones personalizadas.">
    <meta property="og:image" content="https://images.unsplash.com/photo-1507842217343-583bb7270b66?w=1200">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%234F46E5'/%3E%3Cstop offset='100%25' style='stop-color:%23F472B6'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='20' fill='url(%23g)'/%3E%3Ctext x='50' y='70' font-size='60' text-anchor='middle' fill='white'%3Eüìö%3C/text%3E%3C/svg%3E">

    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:wght@700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/visuals.css">

    <!-- Theme Color -->
    <meta name="theme-color" content="#4F46E5">
    <meta name="msapplication-TileColor" content="#4F46E5">

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BiblioTech Pro">
    <link rel="apple-touch-icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect width='180' height='180' rx='40' fill='%236366F1'/><text x='50%' y='55%' dominant-baseline='middle' text-anchor='middle' font-size='90' font-family='Arial' fill='white'>üìö</text></svg>">
</head>

<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">
                <i class="fa-solid fa-book-open fa-3x"></i>
            </div>
            <div class="loading-text">BiblioTech Pro</div>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
        </div>
    </div>

    <div id="app">
        <!-- Notification Container -->
        <div id="toast-container" aria-live="polite" aria-atomic="true"></div>

        <!-- Login View -->
        <div id="login-view" class="login-wrapper">
            <!-- Floating particles background -->
            <div class="particles" aria-hidden="true">
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
            </div>

            <div class="login-card">
                <div class="login-logo">
                    <i class="fa-solid fa-book-open"></i>
                </div>
                <h1>BiblioTech <span class="pro-badge">Pro</span></h1>
                <p class="login-subtitle">Sistema de Gesti√≥n Bibliotecaria Inteligente</p>

                <form id="login-form" autocomplete="off">
                    <div class="form-group">
                        <label for="username" class="form-label">
                            <i class="fa-solid fa-user"></i> Usuario
                        </label>
                        <select id="username" class="form-input" required aria-describedby="username-help">
                            <option value="">Conectando con el servidor...</option>
                        </select>
                        <small id="username-help" class="form-help">Selecciona tu perfil de acceso</small>
                    </div>

                    <div class="form-group">
                        <label for="password" class="form-label">
                            <i class="fa-solid fa-lock"></i> Contrase√±a
                        </label>
                        <div class="password-wrapper">
                            <input type="password" id="password" class="form-input"
                                placeholder="Introduce tu contrase√±a" required aria-describedby="password-help">
                            <button type="button" class="password-toggle" aria-label="Mostrar contrase√±a">
                                <i class="fa-solid fa-eye"></i>
                            </button>
                        </div>
                        <small id="password-help" class="form-help">Introduce tu contrase√±a de acceso</small>
                    </div>

                    <button type="submit" class="btn btn-primary btn-login">
                        <span class="btn-text">
                            <i class="fa-solid fa-arrow-right-to-bracket"></i> Acceder al Sistema
                        </span>
                        <span class="btn-loading hidden">
                            <i class="fa-solid fa-circle-notch fa-spin"></i> Verificando...
                        </span>
                    </button>

                    <div id="login-error" class="login-error" role="alert"></div>
                </form>

                <div class="login-footer">
                    <p><i class="fa-solid fa-shield-halved"></i> Conexi√≥n segura</p>
                    <p class="version">v2.0.0 Premium Edition</p>
                </div>
            </div>
        </div>

        <!-- Dashboard View -->
        <div id="dashboard-view" class="dashboard-container hidden">
            <!-- Sidebar -->
            <aside class="sidebar" role="navigation" aria-label="Navegaci√≥n principal">
                <div class="sidebar-brand" role="banner">
                    <div class="brand-icon">
                        <i class="fa-solid fa-book-open"></i>
                    </div>
                    <div class="brand-text">
                        <span class="brand-name">BiblioTech</span>
                        <span class="brand-pro">Pro</span>
                    </div>
                </div>

                <nav class="sidebar-nav">
                    <div class="nav-section">
                        <span class="nav-section-title">Principal</span>
                        <div class="nav-item active" data-target="catalog-section" role="button" tabindex="0">
                            <i class="fa-solid fa-compass"></i>
                            <span>Explorar</span>
                            <span class="nav-badge" id="catalog-count"></span>
                        </div>
                        <div class="nav-item" data-target="my-loans-section" id="nav-loans" role="button" tabindex="0">
                            <i class="fa-solid fa-bookmark"></i>
                            <span>Mis Libros</span>
                        </div>
                        <div class="nav-item" data-target="recommendations-section" id="nav-recs" role="button"
                            tabindex="0">
                            <i class="fa-solid fa-wand-magic-sparkles"></i>
                            <span>IA Recomendaciones</span>
                            <span class="nav-new">NEW</span>
                        </div>
                    </div>

                    <div class="nav-section" id="admin-section" style="display:none;">
                        <span class="nav-section-title">Administraci√≥n</span>
                        <div class="nav-item" data-target="librarian-section" id="nav-librarian" role="button"
                            tabindex="0">
                            <i class="fa-solid fa-gauge-high"></i>
                            <span>Panel de Control</span>
                        </div>
                    </div>
                </nav>

                <div id="active-reading-widget" class="active-reading-widget hidden">
                    <!-- Injected by JS -->
                </div>

                <div class="sidebar-footer">
                    <div class="nav-item" id="logout-btn" role="button" tabindex="0">
                        <i class="fa-solid fa-arrow-right-from-bracket"></i>
                        <span>Cerrar Sesi√≥n</span>
                    </div>
                    <div class="sidebar-version">
                        <i class="fa-solid fa-code-branch"></i> v2.0.0
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content" role="main">
                <header class="header-bar">
                    <div class="header-left">
                        <h1 id="page-title" class="page-title">Explorar Cat√°logo</h1>
                        <p id="page-subtitle" class="page-subtitle">Descubre tu pr√≥xima aventura literaria</p>
                    </div>
                    <div class="header-right">
                        <div class="header-actions">
                            <button id="dark-mode-toggle" class="btn btn-icon theme-toggle-btn" title="Cambiar tema"
                                aria-label="Alternar modo oscuro">
                                <i class="fa-solid fa-moon"></i>
                            </button>
                        </div>
                        <div class="user-profile">
                            <div class="user-info">
                                <div id="user-display" class="user-name">Usuario</div>
                                <div id="user-role" class="user-role">Socio</div>
                            </div>
                            <div class="user-avatar" id="user-avatar" aria-label="Avatar de usuario">U</div>
                        </div>
                    </div>
                </header>

                <!-- Catalog Section -->
                <section id="catalog-section" class="section fade-in" aria-labelledby="catalog-title">
                    <div class="filters-container glass-panel">
                        <div class="search-wrapper">
                            <label class="input-label" for="search-input">
                                <i class="fa-solid fa-magnifying-glass"></i> B√∫squeda
                            </label>
                            <div class="search-input-group">
                                <i class="fa-solid fa-search" aria-hidden="true"></i>
                                <input type="text" id="search-input" class="form-input search-field"
                                    placeholder="Buscar por t√≠tulo o autor..." aria-label="Buscar libros">
                            </div>
                        </div>

                        <div class="category-filter-wrapper">
                            <label class="input-label" for="filter-category">
                                <i class="fa-solid fa-layer-group"></i> Categor√≠a
                            </label>
                            <div class="search-input-group">
                                <i class="fa-solid fa-filter" aria-hidden="true"></i>
                                <select id="filter-category" class="form-input search-field"
                                    aria-label="Filtrar por categor√≠a">
                                    <option value="Todas">üìö Todas las categor√≠as</option>
                                    <option value="Novela">üìñ Novela</option>
                                    <option value="Ciencia Ficci√≥n">üöÄ Ciencia Ficci√≥n</option>
                                    <option value="Fantas√≠a">üêâ Fantas√≠a</option>
                                    <option value="Biograf√≠a">üë§ Biograf√≠a</option>
                                    <option value="Historia">üèõÔ∏è Historia</option>
                                    <option value="Tecnolog√≠a">üíª Tecnolog√≠a</option>
                                </select>
                            </div>
                        </div>

                        <div class="filter-options">
                            <label class="checkbox-wrapper">
                                <input type="checkbox" id="filter-unread" class="checkbox-custom">
                                <span class="checkbox-label">
                                    <i class="fa-solid fa-eye-slash"></i> Ocultar le√≠dos
                                </span>
                            </label>
                        </div>

                        <button id="apply-filters-btn" class="btn btn-primary">
                            <i class="fa-solid fa-filter"></i> Aplicar Filtros
                        </button>
                    </div>

                    <!-- Stats Bar -->
                    <div class="stats-bar">
                        <div id="book-counter" class="stat-item">
                            <i class="fa-solid fa-book"></i>
                            <span>Cargando cat√°logo...</span>
                        </div>
                    </div>

                    <div id="catalog-list" class="card-grid" role="list" aria-label="Lista de libros"></div>
                </section>

                <!-- My Loans Section -->
                <section id="my-loans-section" class="section hidden" aria-labelledby="loans-title">
                    <div class="section-header">
                        <h2 id="reservations-title">
                            <i class="fa-solid fa-clock"></i> Reservas Activas
                            <span class="section-badge">24h</span>
                        </h2>
                    </div>
                    <div id="my-blocks-list" class="card-grid" role="list"></div>

                    <div class="section-header">
                        <h2 id="active-loans-title">
                            <i class="fa-solid fa-book-reader"></i> Lecturas en Curso
                        </h2>
                    </div>
                    <div id="my-active-loans-list" class="card-grid" role="list"></div>

                    <div class="section-header">
                        <h2 id="history-title">
                            <i class="fa-solid fa-history"></i> Historial de Lectura
                        </h2>
                    </div>
                    <div class="table-wrapper glass-panel">
                        <table class="data-table" role="table">
                            <thead>
                                <tr>
                                    <th scope="col"><i class="fa-solid fa-book"></i> Libro</th>
                                    <th scope="col"><i class="fa-solid fa-calendar-plus"></i> Obtenido</th>
                                    <th scope="col"><i class="fa-solid fa-calendar-check"></i> Devuelto</th>
                                    <th scope="col" class="text-center"><i class="fa-solid fa-circle-check"></i> Estado
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="my-history-list"></tbody>
                        </table>
                    </div>
                </section>

                <!-- Recommendations Section -->
                <section id="recommendations-section" class="section hidden" aria-labelledby="recs-title">
                    <div class="recommendations-hero">
                        <div class="hero-content">
                            <div class="hero-icon">
                                <i class="fa-solid fa-brain"></i>
                            </div>
                            <h2 id="recs-title">
                                <i class="fa-solid fa-sparkles"></i> Recomendaciones Personalizadas
                            </h2>
                            <p>Nuestra inteligencia artificial <strong>Gemini</strong> analiza tu historial de lectura
                                para sugerirte t√≠tulos que te encantar√°n.</p>
                        </div>
                        <button id="get-recs-btn" class="btn btn-hero">
                            <i class="fa-solid fa-wand-magic-sparkles"></i> Generar Recomendaciones
                        </button>
                    </div>

                    <div id="gemini-loading" class="hidden loading-container">
                        <div class="ai-loading">
                            <div class="ai-icon">
                                <i class="fa-solid fa-robot fa-3x"></i>
                            </div>
                            <div class="ai-animation">
                                <span></span><span></span><span></span>
                            </div>
                            <p>Analizando tu perfil de lectura...</p>
                        </div>
                    </div>

                    <div id="recommendations-content" class="card-grid" role="list"></div>
                </section>

                <!-- Librarian Section -->
                <section id="librarian-section" class="section hidden" aria-labelledby="admin-title">
                    <!-- Dynamic Content Injected by JS -->
                </section>

            </main>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>

    <!-- Inline script for loading screen -->
    <script>
        window.addEventListener('load', () => {
            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
                setTimeout(() => {
                    loadingScreen.classList.add('fade-out');
                    setTimeout(() => loadingScreen.remove(), 500);
                }, 800);
            }
        });

        // Password visibility toggle
        document.addEventListener('DOMContentLoaded', () => {
            const toggle = document.querySelector('.password-toggle');
            const password = document.getElementById('password');
            if (toggle && password) {
                toggle.addEventListener('click', () => {
                    const type = password.type === 'password' ? 'text' : 'password';
                    password.type = type;
                    toggle.innerHTML = type === 'password'
                        ? '<i class="fa-solid fa-eye"></i>'
                        : '<i class="fa-solid fa-eye-slash"></i>';
                });
            }
        });

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('‚úÖ ServiceWorker registrado:', registration.scope);
                    })
                    .catch(error => {
                        console.log('‚ö†Ô∏è ServiceWorker no registrado:', error);
                    });
            });
        }

        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;

            // Show custom install banner
            const banner = document.createElement('div');
            banner.id = 'pwa-install-banner';
            banner.innerHTML = `
                <div style="
                    position: fixed;
                    bottom: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);
                    color: white;
                    padding: 16px 24px;
                    border-radius: 16px;
                    box-shadow: 0 10px 40px rgba(99, 102, 241, 0.4);
                    display: flex;
                    align-items: center;
                    gap: 16px;
                    z-index: 10000;
                    animation: slide-up 0.5s ease-out;
                    max-width: 90%;
                ">
                    <i class="fa-solid fa-mobile-screen-button" style="font-size: 1.5rem;"></i>
                    <div>
                        <div style="font-weight: 700;">Instalar BiblioTech Pro</div>
                        <div style="font-size: 0.8rem; opacity: 0.9;">Acceso r√°pido desde tu pantalla de inicio</div>
                    </div>
                    <button id="pwa-install-btn" style="
                        background: white;
                        color: #6366F1;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 8px;
                        font-weight: 700;
                        cursor: pointer;
                        white-space: nowrap;
                    ">Instalar</button>
                    <button id="pwa-dismiss-btn" style="
                        background: none;
                        border: none;
                        color: white;
                        cursor: pointer;
                        padding: 4px;
                        opacity: 0.7;
                    "><i class="fa-solid fa-xmark"></i></button>
                </div>
            `;
            document.body.appendChild(banner);

            document.getElementById('pwa-install-btn').addEventListener('click', async () => {
                banner.remove();
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log('PWA install outcome:', outcome);
                deferredPrompt = null;
            });

            document.getElementById('pwa-dismiss-btn').addEventListener('click', () => {
                banner.remove();
            });
        });
    </script>
</body>

</html>