
Proyecto Integrado: Biblioteca Web
Stack: Front (HTML/CSS/JS) · Backend (Spring Boot REST) · BBDD (Oracle) ·
Seguridad (JWT recomendado) · IA Generativa (Gemini) · Despliegue/Operación
Producto final: Aplicación desplegada + scripts Oracle (tablas/triggers/jobs) +
documentación técnica + evidencias por módulos

1. Contexto y objetivo
Vais a desarrollar una aplicación web de gestión de biblioteca con:
• Catálogo de libros y sus ejemplares (copias físicas).
• Gestión de socios.
• Gestión de préstamos (solo personal bibliotecario).
• Un sistema de bloqueo/reserva de ejemplar durante 1 día (solo socio).
• Reglas de negocio obligatorias implementadas en Oracle mediante triggers
(especialmente en la inserción del préstamo).
• Un servicio de recomendación de libros basado en histórico de préstamos
usando la API de Gemini (IA generativa), cumpliendo privacidad y buenas
prácticas.
Este proyecto conecta explícitamente con:
• Seguridad y Alta Disponibilidad
• Implantación de Aplicaciones Web
• Servicios de Red e Internet
• Administración de SGBD (Oracle)
• Inteligencia Artificial Generativa
• Administración de Sistemas Operativos

2. Cambios clave del modelo de uso
2.1. Rol SOCIO (desde la web / API)
El socio NO puede solicitar ni crear préstamos por API.
El socio solo puede:
• Consultar catálogo (libros/ejemplares disponibles).
• Ver su histórico de préstamos (lectura).
• Bloquear 1 ejemplar como máximo durante 1 día (24h o hasta fin de día
según diseño acordado).
• Cancelar su bloqueo si lo desea.

2.2. Rol BIBLIOTECARIO
El bibliotecario:
• Gestiona préstamos (creación/devolución).
• Gestiona ejemplares (altas/bajas/estado).
• Convierte un bloqueo válido en un préstamo (si aplica).
2.3. Limpieza automática diaria (daemon/job en Oracle)
Al finalizar el día, un proceso programado en Oracle (job) debe:
• Detectar bloqueos caducados y desbloquear los ejemplares que no se retiraron.
• Marcar esos bloqueos como EXPIRADOS.

3. Alcance funcional mínimo
3.1. Autenticación y autorización (JWT recomendado)
Se implementará JWT (stateless) por ser más compatible con alta disponibilidad.
Roles mínimos:
• ADMIN: administración global
• BIBLIOTECARIO: préstamos/ejemplares/libros
• SOCIO: consulta + bloqueo 1 día + histórico propio
Requisitos:
• Hash de contraseña seguro (BCrypt)
• Control por roles en endpoints
• Secretos por variables de entorno (nunca en el código)
• CORS configurado correctamente
• HTTPS en despliegue (real o justificado en laboratorio)

4. Modelo de datos en Oracle (sugerencia revisada:
LIBRO + EJEMPLAR)
A continuación se propone un modelo mínimo con separación Libro (obra) y
Ejemplar (copia física). Podéis ampliarlo si se justifica.
4.1. Tablas principales
SOCIO

• ID_SOCIO (PK)
• USUARIO (UNIQUE)
• PASSWORD_HASH
• ROL (SOCIO/BIBLIOTECARIO/ADMIN)
• PENALIZACION_HASTA (DATE o TIMESTAMP, nullable)
• MAX_PRESTAMOS_ACTIVOS (NUMBER, default 3)
• (opcionales) NOMBRE, EMAIL (siempre con cautela en privacidad)
LIBRO (la obra)
• ID_LIBRO (PK)
• ISBN (UNIQUE)
• TITULO
• AUTOR
• CATEGORIA
• ANIO
EJEMPLAR (copia física)
• ID_EJEMPLAR (PK)
• ID_LIBRO (FK → LIBRO)
• CODIGO_BARRAS o SIGNATURA (UNIQUE)
• ESTADO (DISPONIBLE / BLOQUEADO / PRESTADO / BAJA)
• UBICACION (opcional: sala/estantería)
BLOQUEO (reserva 1 día por socio)
• ID_BLOQUEO (PK)
• ID_SOCIO (FK → SOCIO)
• ID_EJEMPLAR (FK → EJEMPLAR)
• FECHA_INICIO (TIMESTAMP)
• FECHA_FIN (TIMESTAMP) ← “1 día”
• ESTADO (ACTIVO / CANCELADO / EXPIRADO / CONVERTIDO)
PRESTAMO (solo bibliotecario crea)
• ID_PRESTAMO (PK)
• ID_SOCIO (FK → SOCIO)
• ID_EJEMPLAR (FK → EJEMPLAR)
• FECHA_PRESTAMO
• FECHA_PREVISTA_DEVOLUCION
• FECHA_DEVOLUCION_REAL (nullable)
• ESTADO (ACTIVO / DEVUELTO)
• (opcional) ID_BLOQUEO (FK → BLOQUEO, nullable) para “convertir bloqueo
en préstamo”
4.2. Restricciones mínimas recomendadas
• Índices en FKs (ID_LIBRO, ID_SOCIO, ID_EJEMPLAR)
• EJEMPLAR.ESTADO con check de valores válidos

• Impedir múltiples préstamos activos del mismo ejemplar (por trigger o
constraint según diseño)
• Un socio no debe tener más de 1 bloqueo ACTIVO (por trigger)

5. Reglas de negocio obligatorias (por trigger en
Oracle)
5.1. Trigger obligatorio: inserción de PRÉSTAMO
Debe existir un trigger (recomendado BEFORE INSERT ON PRESTAMO) que impida
insertar un préstamo si:
1. Socio penalizado
• Si PENALIZACION_HASTA > SYSDATE → denegar
2. Límite máximo de préstamos activos superado
• Contar préstamos del socio con ESTADO='ACTIVO'
• Si count >= MAX_PRESTAMOS_ACTIVOS → denegar
3. Ejemplar no disponible
• Si el ejemplar está PRESTADO → denegar
• Si está BLOQUEADO:
o Permitir solo si el bloqueo ACTIVO pertenece a ese socio y no está
caducado
o Si el bloqueo es de otro socio → denegar

4. Consistencia de estado
• Si se inserta el préstamo correctamente:
o Cambiar el EJEMPLAR.ESTADO a PRESTADO
o Si existía bloqueo válido del socio, marcarlo como CONVERTIDO (y
opcionalmente guardar ID_BLOQUEO)

Manejo de error obligatorio
• Ante incumplimiento: RAISE_APPLICATION_ERROR(-20xxx, 'Mensaje
claro')

Nota: aunque el backend valide, la fuente de verdad es el trigger (defensa en
profundidad).

6. Bloqueo 1 día y limpieza automática (Job/Daemon
Oracle)
6.1. Bloqueo por socio (API)
Requisitos del bloqueo:
• Un socio puede tener solo 1 bloqueo ACTIVO
• El bloqueo dura 1 día
• Solo se puede bloquear un ejemplar si está DISPONIBLE
• Al crear un bloqueo, el ejemplar pasa a BLOQUEADO
Esto puede reforzarse con:
• Trigger BEFORE INSERT ON BLOQUEO (recomendado) para validar “1 activo
máximo” y disponibilidad del ejemplar.
6.2. Job diario en Oracle (DBMS_SCHEDULER)
Debe existir un job que se ejecute al final del día (p. ej., 23:59) y:
• Busque bloqueos ACTIVO con FECHA_FIN < SYSDATE
• Los marque como EXPIRADO
• Devuelva el ejemplar a DISPONIBLE (si no fue prestado)
Entregable obligatorio: script .sql que cree el job y su procedimiento asociado.

7. API REST mínima (orientativa)
7.1. Auth
• POST /api/auth/login → JWT
7.2. Catálogo (SOCIO y BIBLIOTECARIO)
• GET /api/libros
• GET /api/libros/{id}
• GET /api/ejemplares?estado=DISPONIBLE&...
7.3. Bloqueos (SOCIO)
• POST /api/bloqueos (crear bloqueo de 1 ejemplar)
• GET /api/bloqueos/mios
• POST /api/bloqueos/{id}/cancelar
7.4. Préstamos (BIBLIOTECARIO)

• POST /api/prestamos (crear préstamo, opcionalmente indicando id_bloqueo)
• POST /api/prestamos/{id}/devolver
• GET /api/prestamos?estado=ACTIVO&...
7.5. Recomendaciones (SOCIO)
• GET /api/recomendaciones/mias
Basado en histórico del socio, sin PII hacia Gemini.
Requisito: Swagger/OpenAPI (/swagger-ui) documentado.

8. IA Generativa (Gemini): servicio de “Libros
aconsejados”
• Entrada: histórico de préstamos (títulos/categorías/autores/fechas) y catálogo
disponible
• Salida: lista de recomendaciones (p. ej., 5) con breve explicación
• Privacidad:
o No enviar nombre, email, DNI, etc.
• Robustez:
o Control de errores, timeout, rate limiting
o Logs sin tokens ni claves

9. Entregables obligatorios
1. Repositorio con:
• /backend Spring Boot
• /frontend HTML/CSS/JS
• /db scripts Oracle (DDL + triggers + job + datos prueba)
• /deploy (docker compose / nginx / scripts)
• /docs memoria técnica
2. Script Oracle completo:
• Tablas, constraints, índices
• Trigger obligatorio de préstamo
• Trigger de bloqueo (recomendado)
• Job diario de desbloqueo
3. Aplicación desplegada (o reproducible local con pasos exactos)
4. Memoria técnica con:
• Arquitectura y red/puertos

• Seguridad (JWT, roles, secretos, HTTPS, hardening mínimo)
• BBDD (modelo + triggers + job + pruebas)
• IA (prompt + privacidad + ejemplos)
• Operación (logs, arranque/parada, copias)

10. Criterios mínimos de aceptación (pruebas)
Debe demostrarse:
• Un socio puede bloquear un ejemplar disponible y no puede bloquear más de 1.
• Al finalizar el día (job), bloqueos caducados se liberan y ejemplares vuelven a
DISPONIBLE.
• El bibliotecario crea préstamo y el trigger impide:
o socio penalizado
o exceso de préstamos activos
o ejemplar no disponible
o ejemplar bloqueado por otro socio
• Al insertar préstamo válido:
o ejemplar pasa a PRESTADO
o bloqueo (si existía) pasa a CONVERTIDO
• Recomendaciones Gemini funcionan sin PII.
